import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:timezone/timezone.dart' as tz;
import 'package:flutter/foundation.dart';
import 'package:theraphy_flutter/main.dart'; // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ flutterLocalNotificationsPlugin ‡∏à‡∏≤‡∏Å main.dart

class CourseEventService {
  static final List<DateTime> _scheduledDates = [];

  static final List<Map<String, dynamic>> courseList = [
    {
      'name': '‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏Ç‡∏≤',
      'exercises': [
        {
          'title': 'Seated Leg Raise',
          'desc': '‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≤',
          'reps': '‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏∞ 10',
          'duration': '~3 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏ô‡∏±‡πà‡∏á‡∏ö‡∏ô‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡∏ö‡∏ô‡∏ï‡πâ‡∏ô‡∏Ç‡∏≤\n‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏ô‡∏ï‡∏∂‡∏á ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á',
        },
        {
          'title': 'Standing Knee Flexion',
          'desc': '‡∏á‡∏≠‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤',
          'reps': '‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏∞ 10',
          'duration': '~3 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏¢‡∏∑‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏à‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏∏‡∏á‡∏ï‡∏±‡∏ß\n‡∏á‡∏≠‡πÄ‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏™‡πâ‡∏ô‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á\n‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 3‚Äì5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
        {
          'title': 'Side Leg Raise',
          'desc': '‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏∞‡πÇ‡∏û‡∏Å',
          'reps': '‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏∞ 10',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏¢‡∏∑‡∏ô‡∏à‡∏±‡∏ö‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡πÅ‡∏û‡∏á\n‡∏¢‡∏Å‡∏Ç‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏ù‡∏±‡πà‡∏á\n‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
        {
          'title': 'Heel Raise',
          'desc': '‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ô‡πà‡∏≠‡∏á',
          'reps': '10‚Äì15 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏¢‡∏∑‡∏ô‡∏ï‡∏£‡∏á ‡πÄ‡∏Ç‡∏¢‡πà‡∏á‡∏™‡πâ‡∏ô‡πÄ‡∏ó‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
      ],
    },
    {
      'name': '‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÑ‡∏´‡∏•‡πà',
      'exercises': [
        {
          'title': 'Shoulder Rolls',
          'desc': '‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡πÑ‡∏´‡∏•‡πà',
          'reps': '10 ‡∏£‡∏≠‡∏ö ‡∏´‡∏ô‡πâ‡∏≤-‡∏´‡∏•‡∏±‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏´‡∏•‡πà‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ 10 ‡∏£‡∏≠‡∏ö\n‡∏´‡∏°‡∏∏‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á 10 ‡∏£‡∏≠‡∏ö',
        },
        {
          'title': 'Shoulder Shrug',
          'desc': '‡∏•‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏∂‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏•‡πà',
          'reps': '10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏¢‡∏Å‡πÑ‡∏´‡∏•‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
        {
          'title': 'Wall Slide',
          'desc': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡πÑ‡∏´‡∏•‡πà',
          'reps': '10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~3 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡πÅ‡∏Ç‡∏ô‡πÅ‡∏ô‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß Y\n‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô-‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ ‡πÇ‡∏î‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ô‡∏ö‡∏ú‡∏ô‡∏±‡∏á',
        },
        {
          'title': 'Shoulder Abduction',
          'desc': '‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≤‡∏á ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÑ‡∏´‡∏•‡πà',
          'reps': '10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~3 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà\n‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
      ],
    },
    {
      'name': '‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÅ‡∏Ç‡∏ô',
      'exercises': [
        {
          'title': 'Arm Circles',
          'desc': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏´‡∏±‡∏ß‡πÑ‡∏´‡∏•‡πà',
          'reps': '10 ‡∏£‡∏≠‡∏ö ‡∏´‡∏ô‡πâ‡∏≤‚Äì‡∏´‡∏•‡∏±‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏Ç‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 10 ‡∏£‡∏≠‡∏ö\n‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏°‡∏∏‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á 10 ‡∏£‡∏≠‡∏ö',
        },
        {
          'title': 'Elbow Flexion',
          'desc': '‡∏ù‡∏∂‡∏Å‡∏á‡∏≠-‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å',
          'reps': '‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏∞ 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏á‡∏≠‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ï‡∏∞‡πÑ‡∏´‡∏•‡πà ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ ‡∏ó‡∏≥‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á',
        },
        {
          'title': 'Arm Extension Forward',
          'desc': '‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡πÅ‡∏Ç‡∏ô‡∏´‡∏ô‡πâ‡∏≤-‡∏ä‡∏π‡∏Ç‡∏∂‡πâ‡∏ô',
          'reps': '10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~2 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡πÅ‡∏Ç‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡∏π‡∏Ç‡∏∂‡πâ‡∏ô\n‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏î‡∏•‡∏á‡∏ä‡πâ‡∏≤ ‡πÜ',
        },
        {
          'title': 'Wall Push-Up',
          'desc': '‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÅ‡∏£‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏Ç‡∏ô/‡∏´‡∏±‡∏ß‡πÑ‡∏´‡∏•‡πà',
          'reps': '10‚Äì15 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          'duration': '~3 ‡∏ô‡∏≤‡∏ó‡∏µ',
          'howto': '‡∏¢‡∏∑‡∏ô‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏ô‡∏±‡∏á 1 ‡∏Å‡πâ‡∏≤‡∏ß\n‡∏°‡∏∑‡∏≠‡∏¢‡∏±‡∏ô‡∏ú‡∏ô‡∏±‡∏á ‡∏á‡∏≠‡∏®‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äì ‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡∏Å',
        },
      ],
    },
  ];

  /// ‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
  static Future<void> scheduleCourseEvent(String courseName, DateTime dateTime) async {
  final tzDateTime = tz.TZDateTime.from(dateTime, tz.local);
  final int id = dateTime.millisecondsSinceEpoch.remainder(100000);
  
  debugPrint('üìÖ ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: $courseName @ $tzDateTime (id=$id)');

  await flutterLocalNotificationsPlugin.zonedSchedule(
    id,
    '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™',
    '‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™: $courseName ‡πÅ‡∏•‡πâ‡∏ß!',
    tzDateTime,
    const NotificationDetails(
      android: AndroidNotificationDetails(
        'main_channel',
        'Main Channel',
        channelDescription: '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û',
        importance: Importance.max,
        priority: Priority.high,
      ),
    ),
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    matchDateTimeComponents: DateTimeComponents.dateAndTime,
  );

  _scheduledDates.add(dateTime);
  debugPrint('‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

  await showScheduledConfirmationNotification(courseName, dateTime);
}



  /// ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö
  static Future<void> testImmediateNotification() async {
    await flutterLocalNotificationsPlugin.show(
      1,
      '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
      '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
      const NotificationDetails(
        android: AndroidNotificationDetails(
          'main_channel',
          'Main Channel',
          channelDescription: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
          importance: Importance.max,
          priority: Priority.high,
        ),
      ),
    );
  }

  /// ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
  static Future<void> showScheduledConfirmationNotification(String courseName, DateTime dateTime) async {
    final timeStr = '${dateTime.hour.toString().padLeft(2, '0')}:${dateTime.minute.toString().padLeft(2, '0')}';
    await flutterLocalNotificationsPlugin.show(
      2,
      '‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
      '‡∏Ñ‡∏≠‡∏£‡πå‡∏™: $courseName ‡πÄ‡∏ß‡∏•‡∏≤ $timeStr',
      const NotificationDetails(
        android: AndroidNotificationDetails(
          'main_channel',
          'Main Channel',
          channelDescription: '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
          importance: Importance.high,
          priority: Priority.high,
        ),
      ),
    );
  }

  static List<DateTime> getScheduledDates() => _scheduledDates;
}
